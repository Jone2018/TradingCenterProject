pipeline:

  publish_app:
    image: plugins/docker
    repo: suiqiu/tradingcenter
    dockerfile: Dockerfile
    secrets: [ docker_username, docker_password ]
    tags:
      - latest
      - ${DRONE_BRANCH}
    when:
      branch: [ master ]
      event: push

  deploy:
    image: quay.io/honestbee/drone-kubernetes
    secrets: [ KUBERNETES_SERVER, KUBERNETES_CERT, KUBERNETES_TOKEN ]
    namespace: ingress-nginx
    deployment: tradingcenter
    repo: suiqiu/tradingcenter
    container: tradingcenter
    tag: latest
